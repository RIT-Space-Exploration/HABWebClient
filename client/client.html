<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.min.js" charset="utf-8"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>

<body>


    <form id="temp_select" multiple="true" onchange="tempChange()">
        <input type="checkbox" value="0" checked="true">Temp0</input>
        <input type="checkbox" value="1" checked="true">Temp1</input>
    </form>
    <script type="text/javascript">
        function tempChange() {
            var chart = $('#container').highcharts();
            var series = chart.series
            var checks = document.getElementById("temp_select");
            var max = (new Date()).getTime();
            var min = max - (60*1000);
            for(var i=0 ; i<checks.length ; i++) {
                if(checks[i].checked) {
                    series[i].show();
                } else {
                    series[i].hide();
                }
            }
            chart.xAxis[0].setExtremes(min, max, true, false);
        }
    </script>
    <div id="container" style="height: 400px; min-width: 310px"></div>
    <!-- <script src="https://code.highcharts.com/highcharts.js"></script> -->
    <script type="text/javascript">
        var chart1;
        $(function() {

            Highcharts.setOptions({
                global: {
                    useUTC: false
                }
            });
            

            chart1 = Highcharts.stockChart('container', {
                chart: {
                    events: {
                        load: function() {}
                    }
                },
                rangeSelector: {
                    buttons: [{
                        count: 1,
                        type: 'minute',
                        text: '1M'
                    }, {
                        count: 5,
                        type: 'minute',
                        text: '5M'
                    }, {
                        type: 'all',
                        text: 'All'
                    }],
                    inputEnabled: false,
                    selected: 0
                },
                legend: {
                    enabled: true
                },
                title: {
                    text: 'Temperature Sensors'
                },
                yAxis: {
                    title: {
                        text: 'Rando'
                    },
                    min: 0,
                    max: 100,
                    plotLines: [{
                        id: "min",
                        value: minimum,
                        color: 'cyan',
                        dashStyle: 'longdash',
                        width: 2,
                        label: {
                            text: 'Minimum'
                        }
                    }, {
                        id: "max",
                        value: maximum,
                        color: 'blue',
                        dashStyle: 'longdash',
                        width: 2,
                        label: {
                            text: 'Maximum'
                        }
                    }]
                },

                exporting: {
                    enabled: false
                },
                series: [{
                    type: "line",
                    name: 'Temp0',
                    data: (function() {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;
                        for (i = -999; i <= 0; i += 1) {
                            data.push([
                                time + i * 1000,
                                Math.round(Math.random() * 98 +1)
                            ]);
                        }
                        return data;
                    }())
                },{
                    type: "line",
                    name: 'Temp1',
                    data: (function() {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;
                        for (i = -999; i <= 0; i += 1) {
                            data.push([
                                time + i * 1000,
                                Math.round(Math.random() * 98+1)
                            ]);
                        }
                        return data;
                    }())
                }]
            });
            // set up the updating of the chart each second
            var series0 = chart1.series[0];
            var series1 = chart1.series[1];
            setInterval(function() {
                var x = (new Date()).getTime(), // current time
                    y0 = Math.round(Math.random() * 98 +1);
                    y1 = Math.round(Math.random() * 98 +1);
                series0.addPoint([x, y0], true, true,false);
                series1.addPoint([x, y1], true, true,false);
                // console.log(x, y0, y1);
                chart1.xAxis[0].removePlotBand("min");
                chart1.xAxis[0].removePlotBand("max");
                chart.xAxis[0].addPlotLine({
                                            id: "min",
                                            value: minimum,
                                            color: 'cyan',
                                            dashStyle: 'longdash',
                                            width: 2,
                                            label: {
                                                text: 'Minimum'
                                            }
                                        });
                chart.xAxis[0].addPlotLine({
                                            id: "max",
                                            value: maximum,
                                            color: 'cyan',
                                            dashStyle: 'longdash',
                                            width: 2,
                                            label: {
                                                text: 'Maximum'
                                            }
                                        });
            }, 100);

        });
        var minimum = 0;
        var maximum = 0;
        var p;
        for(var i=0 ; i<chart1.series.length ; i++) {
            p[i] = chart1.series[i].points.x
        }
        for (var i=0 ; i<p.length ; i++) {
            for (var j=0 ; j<p[i].length ; j++) {
                if(minimum == 0) {
                    minimum = p[i][j].y
                } else {
                    minimum = p[i][j].y < minimum ? p[i][j].y : minimum;
                }
                maximum = p[i][j].y > minimum ? p[i][j].y : maximum;
            }
        }
    </script>



    </script>
    <script type="text/javascript">
    var socket;
    let user;

    const connectSocket = (e) => {
      socket = io.connect();

      socket.on('broadcastData', (data) => {
        console.log(data);
      });

      socket.on('connect', () => {
        console.log('connected to server');
        if(!user) {
          user = "unknown";
        }

        socket.emit('join', {name: user, type: "dataListener" });
      });
    }

    const init = () => {
      console.log('init');
      connectSocket();
    };

    window.onload = init;

    </script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>

</body>

</html>
